<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:appointex.ViewModels"
             xmlns:models="clr-namespace:appointex.Models"
             x:Class="appointex.HistoryPage"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto, *">

        <Label Text="Historial"
               Grid.Row="0"
               FontSize="28"
               FontFamily="Montserrat-Bold"
               TextColor="Black"
               Margin="20,50,20,10"/>

        <RefreshView Grid.Row="1"
                     Command="{Binding RefreshCommand}"
                     IsRefreshing="{Binding IsRefreshing}"
                     RefreshColor="#ffd917">

            <CollectionView ItemsSource="{Binding Appointments}"
                            SelectionMode="None"
                            Margin="0,0,0,20">

                <CollectionView.EmptyView>
                    <StackLayout VerticalOptions="Center"
                            HorizontalOptions="Center"
                            Margin="0,100,0,0">
                        <Label Text="{Binding EmptyMessage}"
                               TextColor="Gray"
                               FontSize="16"
                               FontFamily="Montserrat-Regular"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:AppAppointment">
                        <Grid Padding="20,8">
                            <Border BackgroundColor="#f5f5f5"
                                    StrokeThickness="0"
                                    Padding="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="15"/>
                                </Border.StrokeShape>

                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HistoryViewModel}}, Path=GoToDetailsCommand}"
                                                          CommandParameter="{Binding .}"/>
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="6, *">

                                    <BoxView Grid.Column="0"
                                             Color="{Binding StatusColor}"
                                             VerticalOptions="Fill"/>

                                    <Grid Grid.Column="1"
                                          RowDefinitions="Auto, Auto, Auto"
                                          ColumnDefinitions="*, Auto"
                                          Padding="15,15">

                                        <Label Grid.Row="0"
                                                Grid.Column="0"
                                               Text="{Binding Service.Name}"
                                               FontSize="16"
                                               FontFamily="Montserrat-Bold"
                                               TextColor="Black"
                                               LineBreakMode="TailTruncation"/>

                                        <Border Grid.Row="0"
                                                Grid.Column="1"
                                                Stroke="{Binding StatusColor}"
                                                StrokeThickness="1"
                                                BackgroundColor="Transparent"
                                                Padding="8,4"
                                                VerticalOptions="Start">

                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8"/>
                                            </Border.StrokeShape>

                                            <Label Text="{Binding StatusText}"
                                                   FontSize="11"
                                                   FontFamily="Montserrat-SemiBold"
                                                   TextColor="{Binding StatusColor}"/>
                                        </Border>

                                        <HorizontalStackLayout Grid.Row="1"
                                                Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Spacing="5"
                                                Margin="0,5,0,0">
                                            <Image Source="despertador.png"
                                                    HeightRequest="14"
                                                    Opacity="0.5"/>
                                            <Label Text="{Binding DateTime, StringFormat='{0:dd MMM yyyy â€¢ hh:mm tt}'}"
                                                   FontSize="13"
                                                   FontFamily="Montserrat-Medium"
                                                   TextColor="#555555"/>
                                        </HorizontalStackLayout>

                                        <HorizontalStackLayout Grid.Row="2"
                                                Grid.Column="0"
                                                Grid.ColumnSpan="2"
                                                Spacing="5"
                                                Margin="0,10,0,0">
                                            <Label Text="{Binding DisplayRoleLabel, StringFormat='{0}:'}"
                                                   FontSize="13"
                                                   TextColor="Gray"
                                                   FontFamily="Montserrat-Regular"/>

                                            <Label Text="{Binding DisplayName}"
                                                   FontSize="13"
                                                   TextColor="Black"
                                                   FontFamily="Montserrat-SemiBold"/>
                                        </HorizontalStackLayout>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <ActivityIndicator Grid.RowSpan="2"
                           IsRunning="{Binding IsBusy}"
                           IsVisible="{Binding IsBusy}"
                           Color="#ffd917"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
    </Grid>
</ContentPage>