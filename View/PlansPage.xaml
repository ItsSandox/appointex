<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:appointex.ViewModels"
             xmlns:models="clr-namespace:appointex.Models"
             x:Class="appointex.PlansPage"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False"
             BackgroundColor="#ffd917">

    <Grid RowDefinitions="Auto, *">

        <StackLayout Grid.Row="0" Padding="0,30,0,20">
            <ImageButton Source="flecha_atras.png"
                         Command="{Binding BackCommand}"
                         HeightRequest="30"
                         WidthRequest="30"
                         Margin="15,0,0,0"
                         HorizontalOptions="Start"/>

            <Label Text="Mejora tu Plan"
                   FontSize="26"
                   FontFamily="Montserrat-SemiBold"
                   TextColor="Black"
                   HorizontalOptions="Start" 
                   Margin="20,10,20,5"/>

            <Label Text="Desbloquea todo el potencial de tu negocio."
                   FontSize="15"
                   FontFamily="Montserrat-Regular"
                   TextColor="#333"
                   HorizontalOptions="Start"
                   Margin="20,0,20,0"/>
        </StackLayout>

        <Border Grid.Row="1"
                BackgroundColor="White"
                StrokeThickness="0">
            <Border.StrokeShape>
                <RoundRectangle CornerRadius="40,40,0,0"/>
            </Border.StrokeShape>

            <ScrollView>
                <VerticalStackLayout BindableLayout.ItemsSource="{Binding Plans}"
                                     Padding="20,30,20,80" 
                                     Spacing="25">
                                     <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="models:PlanModel">

                            <Border StrokeThickness="0"
                                    BackgroundColor="{Binding HeaderColor}"
                                    Padding="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="25"/>
                                </Border.StrokeShape>
                                <Border.Shadow>
                                    <Shadow Brush="Black" Offset="0,5" Opacity="0.1" Radius="10"/>
                                </Border.Shadow>

                                <Grid RowDefinitions="Auto, Auto, Auto, Auto, Auto" 
                                      Padding="25">

                                    <Border Grid.Row="0"
                                            IsVisible="{Binding IsPopular}"
                                            BackgroundColor="Black"
                                            HorizontalOptions="End"
                                            Padding="10,4"
                                            StrokeShape="RoundRectangle 10"
                                            Margin="0,-10,-10,10">
                                        <Label Text="RECOMENDADO"
                                               TextColor="#ffd917"
                                               FontSize="10"
                                               FontFamily="Montserrat-Bold"/>
                                    </Border>

                                    <VerticalStackLayout Grid.Row="1" Spacing="5">
                                        <Label Text="{Binding Name}"
                                               FontSize="20"
                                               FontFamily="Montserrat-Bold"
                                               TextColor="{Binding TextColor}"
                                               HorizontalOptions="Start"/>

                                        <HorizontalStackLayout Spacing="4" VerticalOptions="End" HorizontalOptions="Start">
                                            <Label Text="{Binding Price}"
                                                   FontSize="32"
                                                   FontFamily="Montserrat-Bold"
                                                   TextColor="{Binding TextColor}"/>
                                            <Label Text="{Binding Period}"
                                                   FontSize="16"
                                                   FontFamily="Montserrat-Medium"
                                                   TextColor="{Binding TextColor}"
                                                   VerticalOptions="Center"
                                                   Opacity="0.7"/>
                                        </HorizontalStackLayout>

                                        <Label Text="{Binding Description}"
                                               FontSize="14"
                                               FontFamily="Montserrat-Regular"
                                               TextColor="{Binding TextColor}"
                                               Opacity="0.8"
                                               HorizontalOptions="Start"
                                               Margin="0,5,0,0"/>
                                    </VerticalStackLayout>

                                    <BoxView Grid.Row="2"
                                             HeightRequest="1"
                                             Color="{Binding TextColor}"
                                             Opacity="0.1"
                                             Margin="0,15,0,15"/>

                                    <VerticalStackLayout Grid.Row="3" 
                                                         BindableLayout.ItemsSource="{Binding Features}"
                                                         Spacing="10"
                                                         HorizontalOptions="Start">
                                        <BindableLayout.ItemTemplate>
                                            <DataTemplate>
                                                <HorizontalStackLayout Spacing="10">
                                                    <Label Text="âœ“"
                                                           FontSize="16"
                                                           TextColor="{Binding BindingContext.TextColor, Source={RelativeSource AncestorType={x:Type Border}}}"
                                                           FontFamily="Montserrat-Bold"/>
                                                    
                                                    <Label Text="{Binding .}"
                                                           FontSize="14"
                                                           FontFamily="Montserrat-Medium"
                                                           TextColor="{Binding BindingContext.TextColor, Source={RelativeSource AncestorType={x:Type Border}}}"
                                                           Opacity="0.9"
                                                           HorizontalOptions="Start"/>
                                                </HorizontalStackLayout>
                                            </DataTemplate>
                                        </BindableLayout.ItemTemplate>
                                    </VerticalStackLayout>

                                    <Button Grid.Row="4"
                                            Text="Elegir Plan"
                                            Command="{Binding BindingContext.SelectPlanCommand, Source={RelativeSource AncestorType={x:Type ContentPage}}}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{Binding ButtonColor}"
                                            TextColor="Black"
                                            FontFamily="Montserrat-SemiBold"
                                            CornerRadius="25"
                                            HeightRequest="50"
                                            Margin="0,25,0,0"/>

                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>
            </ScrollView>
        </Border>
    </Grid>
</ContentPage>